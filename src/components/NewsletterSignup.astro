---
interface Props {
  variant?: 'inline' | 'card';
}

const { variant = 'card' } = Astro.props;
---

{variant === 'card' ? (
  <div class="bg-[var(--color-cream)] rounded-2xl p-8 md:p-12">
    <div class="max-w-2xl mx-auto text-center">
      <h3 class="text-2xl md:text-3xl font-bold text-gray-900 mb-3">Stay Connected</h3>
      <p class="text-gray-600 mb-6">
        Join our newsletter to receive updates about our programs, impact stories, and ways you can help.
      </p>
      <form id="newsletter-form" class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
        <input
          type="email"
          name="email"
          placeholder="Enter your email"
          required
          class="flex-1 px-4 py-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--color-teal)] focus:border-transparent"
        />
        <button
          type="submit"
          class="bg-[var(--color-teal)] text-white px-6 py-3 rounded-full font-semibold hover:bg-[var(--color-teal)]/90 transition-colors whitespace-nowrap"
        >
          Subscribe
        </button>
      </form>
      <p class="text-xs text-gray-500 mt-3">We respect your privacy. Unsubscribe at any time.</p>
    </div>
  </div>
) : (
  <form id="newsletter-form-inline" class="flex flex-col sm:flex-row gap-3">
    <input
      type="email"
      name="email"
      placeholder="Enter your email"
      required
      class="flex-1 px-4 py-3 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[var(--color-teal)] focus:border-transparent"
    />
    <button
      type="submit"
      class="bg-[var(--color-teal)] text-white px-6 py-3 rounded-full font-semibold hover:bg-[var(--color-teal)]/90 transition-colors whitespace-nowrap"
    >
      Subscribe
    </button>
  </form>
)}

<script>
  const forms = document.querySelectorAll('#newsletter-form, #newsletter-form-inline');

  forms.forEach(form => {
    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target as HTMLFormElement);
      const email = formData.get('email');

      const btn = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      const originalText = btn.textContent;
      btn.textContent = 'Subscribing...';
      btn.disabled = true;

      try {
        const response = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });

        if (response.ok) {
          btn.textContent = 'Subscribed!';
          btn.classList.remove('bg-[var(--color-teal)]');
          btn.classList.add('bg-green-600');
          (form.querySelector('input[name="email"]') as HTMLInputElement).value = '';
        } else {
          throw new Error('Failed to subscribe');
        }
      } catch (error) {
        btn.textContent = 'Try Again';
        btn.classList.remove('bg-[var(--color-teal)]');
        btn.classList.add('bg-red-600');
      }

      setTimeout(() => {
        btn.textContent = originalText;
        btn.disabled = false;
        btn.classList.remove('bg-green-600', 'bg-red-600');
        btn.classList.add('bg-[var(--color-teal)]');
      }, 3000);
    });
  });
</script>
